<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8">

  <title>UI DISPLAY</title>
  <meta name="description" content="UI DISPLAY">
  <meta name="author" content="Andrew Wong">
  <style>
  #right_panel { float: right; width: 70%; background-color: #F0F0F0;}
  #left_panel{float: left;width: 30%;background-color: #CCCCCC;}
  #clearingdiv {clear: both;}
  #left_greeting{padding: 30px;}
  #left_store_up{padding: 20px; background-color: #f08a8a; border-radius: 30px; margin: 10px;}
  #left_today_specials{padding: 20px; margin: 10px;border-radius: 20px;border-width: 1px;border-style: solid;}
  #left_today_specials_title{text-align: center; font-size: larger;}
  #right_recommendation{padding: 20px; margin: 10px;border-radius: 20px;border-width: 1px;border-style: solid;}
  #right_recommendation_title{text-align: center; font-size: larger;}
  #left_today_specials_table{margin-left: auto; margin-right: auto;}
  #right_recommendation_table{margin-left: auto; margin-right: auto;}
  #page{border-style: solid;border-width: 10px;border-radius: 20px; border-color: #89CFF0; font-family: Sans-serif;}
  .recommendation_image{width: 374px; height: 374px; display: block; margin-left: auto; margin-right: auto;}
  .randomized_image{}
  .recommended_image{}
  .today_spceial_image{width: 174px; height: 174px; display: block; margin-left: auto; margin-right: auto;}
  .retail_price_label:before {content: "USD$";}
  .retail_price_label{left: 30%;}
  .brand{left: 40%}
  .product_name{bottom: 45px; left: 1px;}
  .item_style{position: relative; background-color: #89CFF0; border-radius: 10px;border: 3px solid #BADA55;border-radius: 10px;}
  .on_sale_price_label{font-size: larger;top: -10%; position: relative; left: 50%; background-color: rgba(242, 14, 191, 0.3);}

  #right_recommendation_table td {position: relative; }
  #left_today_specials_table td {position: relative; }

  </style>
  <script
        src="https://code.jquery.com/jquery-3.3.1.min.js"
        integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
        crossorigin="anonymous"></script>
  <!--[if lt IE 9]>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.js"></script>
  <![endif]-->
</head>

<body>

  <div id="page">
    <div id="left_panel">
        <div id="left_greeting">
          Hello, <span id="customer_name"></span><br>
          Welcome back to Macy's!<br>
          We have plenty of perks for you today
        </div>
        <div id="left_store_up">
          STORE PICK UP: <br>
          You have <span id="store_pick_up_items_count"></span> order placed and ready to pick up at <span id="store_pick_up_items_locations"></span>
        </div>
        <div id="left_today_specials">
            <div id="left_today_specials_title">TODAY SPECIALS</div>
            <table id="left_today_specials_table"></table>
        </div>
    </div>
    <div id="right_panel">
        <div id="right_recommendation">
          <div id="right_recommendation_title">CLOTHING RECOMMEDED FOR THE SEASON</div>
          <table id="right_recommendation_table"></table>
        </div>
    </div>
    <div id="clearingdiv"></div>
</div>
  <script>
    const brand_map = {
      1:"Armani Exchange",
      2:"Calvin Klein",
      3:"Express",
      4:"H&M",
      5:"Abercrombie&Fitch",
      6:"Holister",
      7:"Burberry",
      8:"Tommy Hilfiger",
      9:"Uniqlo",
      10:"Vans",
      11:"American Eagle",
      12:"Aeropostale",
      13:"Old Navy",
      14:"Guess",
      15:"DKNY",
      16:"Ralph Lauren",
      17:"Columbia",
      18:"The North Face",
      19:"Levis",
      20:"Adidas"
    }
    var break_text = function(text){
      console.log(text);
      console.log(text.length);

    }
    var url_today_special = 'http://app-balancer-2089768567.us-west-2.elb.amazonaws.com/app-1/customer/promotions';
    var url_recommendation = 'http://app-balancer-2089768567.us-west-2.elb.amazonaws.com/app-1/customer/recommend';
    function pooling_today_special(){
      console.log("pooling today special called.");
      var xobj = new XMLHttpRequest();
        xobj.open('POST', url_today_special, true);
        xobj.onreadystatechange = function() {
          if (xobj.readyState == 4 && xobj.status == "200") {
              var data = JSON.parse(xobj.responseText);
              /* today_specials create table  */
              var _table_ = document.getElementById("left_today_specials_table");
              _table_.innerHTML = '';
              var today_specials_array = data.data;
              for (var i = 0 ; i < today_specials_array.length / 2; i++) {
                var row = _table_.insertRow(0);
                for( var j = 0; j < 2; ++j){
                  var col = row.insertCell(j);
                  console.log("2 * "+i+" + "+j+" = "+(2 * i + j));
                  console.log(data.data[2 * i + j]);
                  col.innerHTML = "<img class='today_spceial_image' src='"+data.data[2 * i + j].image+"' />";
                  col.innerHTML += "<span class='retail_price_label item_style'> "+data.data[2 * i + j].price+"</span>";
                  col.innerHTML += "<span class='brand item_style'> "+brand_map[data.data[2 * i + j].brand]+"</span>";
                  col.innerHTML += "<span class='product_name item_style'> "+data.data[2 * i + j].productName+"</span>";
                  // col1.innerHTML = data.payload.today_specials[2 * i + j].product_name;
                  // col2.innerHTML = data.payload.today_specials[i + j].product_image;
                  // col3.innerHTML = data.payload.today_specials[i + j].product_retail_price;
                  // col4.innerHTML = data.payload.today_specials[i + j].product_on_sale_price;
                }

            }
          }
        }
        xobj.setRequestHeader("Accept","*");
        xobj.setRequestHeader("Access-Control-Allow-Origin", "*");
        xobj.setRequestHeader("Content-type", "application/json");
        xobj.setRequestHeader("Access-Control-Allow-Methods", "GET, POST, OPTIONS");
        xobj.send(JSON.stringify({"quantity": 4}));
    }
    function pooling_recomendation(){
      console.log("pooling Recommendation called.");
      var xobj = new XMLHttpRequest();
          //xobj.overrideMimeType("application/json");
          xobj.open('POST', url_recommendation, true);
          xobj.onreadystatechange = function() {
              if (xobj.readyState == 4 && xobj.status == "200") {
                  var data = JSON.parse(xobj.responseText);
                  // console.log(data);
                  /* CUSTOMER_NAME */
                  // var customer_name_text = document.createTextNode(data.payload.customer_name);
                  // var customer_name_placeholder = document.getElementById("customer_name");
                  // customer_name_placeholder.replaceWith(customer_name_text);

                  /* store_pick_up_items_count */
                  // var store_pick_up_items_count_text = document.createTextNode(data.payload.store_pick_up_items_count);
                  // var store_pick_up_items_count_placeholder = document.getElementById("store_pick_up_items_count");
                  // store_pick_up_items_count_placeholder.replaceWith(store_pick_up_items_count_text);

                  /* store_pick_up_items_locations */
                  // var store_pick_up_items_locations_text = document.createTextNode(data.payload.store_pick_up_items_locations);
                  // var store_pick_up_items_locations_placeholder = document.getElementById("store_pick_up_items_locations");
                  // store_pick_up_items_locations_placeholder.replaceWith(store_pick_up_items_locations_text);


                  /* recommendation create table  */
                  var _table_ = document.getElementById("right_recommendation_table");
                  _table_.innerHTML = '';
                  var clothing_recommended_array = data.data;
                  for (var i = 0 ; i < clothing_recommended_array.length / 4; i++) {
                    var row = _table_.insertRow(0);
                    for( var j = 0; j < 4; ++j){
                      var col = row.insertCell(j);
                      // console.log("4 * "+i+" + "+j+" = "+(4 * i + j));
                      // console.log(data.data[4 * i + j]);
                      col.innerHTML = "<img class='recommendation_image' src='"+data.data[4 * i + j].image+"' />";
                      col.innerHTML += "<span class='retail_price_label item_style'> "+data.data[4 * i + j].price+"</span>";
                      col.innerHTML += "<span class='brand item_style'> "+brand_map[data.data[4 * i + j].brand]+"</span>";
                      col.innerHTML += "<span class='product_name item_style'> "+data.data[4 * i + j].productName+"</span>";
                      // col1.innerHTML = data.payload.clothing_recommended[4 * i + j].product_name;
                      // col2.innerHTML = data.payload.clothing_recommended[4 * i + j].product_image;
                      // col3.innerHTML = data.payload.clothing_recommended[4 * i + j].product_retail_price;
                      // col4.innerHTML = data.payload.clothing_recommended[4 * i + j].product_on_sale_price;
                    }
                  }
              }else if(xobj.status == "415"){
                alert("SON! Fix the kafak!");
              }
          }

          xobj.setRequestHeader("Accept","*");
          xobj.setRequestHeader("Access-Control-Allow-Origin", "*");
          xobj.setRequestHeader("Content-type", "application/json");
          xobj.setRequestHeader("Access-Control-Allow-Methods", "GET, POST, OPTIONS");
          xobj.send(JSON.stringify({"quantity": 12}));
    };

    pooling_recomendation();
    // var interval_1 = setInterval(pooling_recomendation, 10000 * 4);

    pooling_today_special();
    // var interval_2 = setInterval(pooling_today_special, 40000 * 4);
    // var interval_2 = setInterval(pooling_2, 1000);
    // clearInterval(interval);

  </script>
</body>
</html>
